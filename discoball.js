var e=null,i;function m(a,d){this.ja=a;this.e=d;this.reset()}
m.prototype.P=function(a,d){for(var c in a){this.w[c]=n.document.getElementById(c);this.w[c].width=window.innerWidth;this.w[c].height=window.innerHeight;this.z[c]=this.w[c].getContext("experimental-webgl");this.J[c]=a[c];var f=this.J[c],g=this.z[c];f.e.P();var o=new p("v0",g.VERTEX_SHADER,f.getShaderSource("quatlib")+f.getShaderSource("v0")),h=new p("f0",g.FRAGMENT_SHADER,f.getShaderSource("f0"));f.p=new q(o,h);f.p.create(g);f.p.link(g);o=new p("v1",g.VERTEX_SHADER,f.getShaderSource("quatlib")+f.getShaderSource("v1"));
h=new p("f1",g.FRAGMENT_SHADER,f.getShaderSource("f1"));f.u=new q(o,h);f.u.create(g);f.u.link(g);o=new p("v2",g.VERTEX_SHADER,f.getShaderSource("quatlib")+f.getShaderSource("v2"));h=new p("f2",g.FRAGMENT_SHADER,f.getShaderSource("f2"));f.v=new q(o,h);f.v.create(g);f.v.link(g);g.enable(g.DEPTH_TEST);g.enable(g.CULL_FACE);f.G=g.createBuffer();f.Y=g.createBuffer();g.clearColor(0.1,0.1,0.1,1);f.g=w(new x(0,0,-15));f.K=new z;for(var h=o=new ba,k=2*Math.PI*h.I,r=k/h.o,j=[],D=h.M=0;D<h.o/2;++D){var E=Math.random(),
G=D*2*Math.PI/h.o,A=(D+1)*2*Math.PI/h.o,y=(G+A)/2,B=0.0025/Math.sin(y),y=Math.floor(Math.sin(y)*k/r);h.M+=y;for(var H=0;H<y;++H){var v=H*2*Math.PI/y,l=(H+1)*2*Math.PI/y,s=C(h,G+0.0025*Math.random(),v+B*Math.random()+E),u=C(h,G+0.0025*Math.random(),l-B*Math.random()+E),l=C(h,A-0.0025*Math.random(),l-B*Math.random()+E),v=C(h,A-0.0025*Math.random(),v+B*Math.random()+E),t=[s,u,l,v,s.f(u),u.f(l),l.f(v),v.f(s),s.f(u).f(l).f(v)][Math.floor(Math.random()*9)].t(),Q=new x(0.15,0.15),$=new x(0.15,0.85),R=new x(0.85,
0.85),aa=new x(0.85,0.15);j.push(s.x,s.y,s.a);j.push(t.x,t.y,t.a);j.push(h.j[0],h.j[1],h.j[2]);j.push(Q.x,Q.y);j.push(l.x,l.y,l.a);j.push(t.x,t.y,t.a);j.push(h.j[0],h.j[1],h.j[2]);j.push(R.x,R.y);j.push(u.x,u.y,u.a);j.push(t.x,t.y,t.a);j.push(h.j[0],h.j[1],h.j[2]);j.push($.x,$.y);j.push(s.x,s.y,s.a);j.push(t.x,t.y,t.a);j.push(h.j[0],h.j[1],h.j[2]);j.push(Q.x,Q.y);j.push(v.x,v.y,v.a);j.push(t.x,t.y,t.a);j.push(h.j[0],h.j[1],h.j[2]);j.push(aa.x,aa.y);j.push(l.x,l.y,l.a);j.push(t.x,t.y,t.a);j.push(h.j[0],
h.j[1],h.j[2]);j.push(R.x,R.y)}}b=new Float32Array(j);f.V=o.M*6;g.bindBuffer(g.ARRAY_BUFFER,f.G);g.bufferData(g.ARRAY_BUFFER,b.byteLength,g.STATIC_DRAW);g.bufferSubData(g.ARRAY_BUFFER,0,b);h=o;k=[];r=new x;for(j=h.O=0;j<h.o/2;++j){D=j*2*Math.PI/h.o;E=(j+1)*2*Math.PI/h.o;h.O+=h.o;for(G=0;G<h.o;++G)u=G*2*Math.PI/h.o,l=(G+1)*2*Math.PI/h.o,A=C(h,D,u).b(0.99),B=C(h,D,u).t(),y=C(h,D,l).b(0.99),H=C(h,D,l).t(),s=C(h,E,l).b(0.99),l=C(h,E,l).t(),v=C(h,E,u).b(0.99),u=C(h,E,u).t(),A.f(y).f(s).f(v).t(),k.push(A.x,
A.y,A.a),k.push(B.x,B.y,B.a),k.push(r.x,r.y,r.a),k.push(0,0),k.push(s.x,s.y,s.a),k.push(l.x,l.y,l.a),k.push(r.x,r.y,r.a),k.push(0,0),k.push(y.x,y.y,y.a),k.push(H.x,H.y,H.a),k.push(r.x,r.y,r.a),k.push(0,0),k.push(A.x,A.y,A.a),k.push(B.x,B.y,B.a),k.push(r.x,r.y,r.a),k.push(0,0),k.push(v.x,v.y,v.a),k.push(u.x,u.y,u.a),k.push(r.x,r.y,r.a),k.push(0,0),k.push(s.x,s.y,s.a),k.push(l.x,l.y,l.a),k.push(r.x,r.y,r.a),k.push(0,0)}b=new Float32Array(k);f.ea=o.O*6;g.bindBuffer(g.ARRAY_BUFFER,f.Y);g.bufferData(g.ARRAY_BUFFER,
b.byteLength,g.STATIC_DRAW);g.bufferSubData(g.ARRAY_BUFFER,0,b);f.fa=g.createTexture();g.bindTexture(g.TEXTURE_2D,f.fa);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR_MIPMAP_LINEAR);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE);o=document.createElement("img");o.onload=ca(g,g.TEXTURE_2D,o,!0);o.src="light.png";f.q=0;F(f,g,f.q)}if(d)this.T=0,this.aa=
n.document.getElementById(d),this.Z=(new Date).getTime();this.$()};m.prototype.round=function(a){return Math.round(10*a)/10};
m.prototype.$=function(){for(var a in this.z){var d=window.innerWidth,c=window.innerHeight;if(this.ba[a]!==d||this.X[a]!==c){this.w[a].width=d;this.w[a].height=c;this.ba[a]=d;this.X[a]=c;var f=this.J[a];this.z[a].viewport(0,0,d,c);c=d/c;f.R=[0.2/(c/10- -c/10),0,0,0,0,1,0,0,(c/10+-c/10)/(c/10- -c/10),0,-300.1/299.9,-1,0,0,-60/299.9,0]}}if(this.aa)a=+new Date,this.T=0.25*(a-this.Z||1)+0.75*this.T,this.aa.innerText=this.round(this.T)+" ms",this.Z=a;for(var g in this.z){f=this.J[g];a=this.z[g];if(f.S)f.K=
f.K.b(I(J,K/16));c=f;d=a;if(c.e.e[da]&&!c.e.H[da])c.S=!c.S;if(c.e.e[ea]&&!c.e.H[ea]){++c.q;if(c.q>=L.length)c.q=0;F(c,d,c.q)}if(c.e.e[fa]&&!c.e.H[fa]){--c.q;if(c.q<0)c.q=L.length-1;F(c,d,c.q)}if(c.e.e[ga])c.g=w(M.b(0.1)).b(c.g);if(c.e.e[ha])c.g=w(M.b(-0.1)).b(c.g);if(c.e.e[ia])c.g=w(N.b(0.1)).b(c.g);if(c.e.e[ja])c.g=w(N.b(-0.1)).b(c.g);if(c.e.e[ka])c.g=w(J.b(0.1)).b(c.g);if(c.e.e[la])c.g=w(J.b(-0.1)).b(c.g);if(c.e.e[ma])c.g=I(J,K).b(c.g);if(c.e.e[na])c.g=I(J,-K).b(c.g);if(c.e.e[oa])c.g=I(N,K).b(c.g);
if(c.e.e[pa])c.g=I(N,-K).b(c.g);if(c.e.e[qa])c.g=I(M,K).b(c.g);if(c.e.e[ra])c.g=I(M,-K).b(c.g);a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT);c=f;d=a;d.useProgram(c.p.handle);d.cullFace(d.BACK);d.uniformMatrix4fv(c.p.uProjection,!1,c.R);d.uniform1i(c.p.uTexture,c.U);var o=(new O([c.g])).get();d.uniform4fv(c.p.uCamera,o);o=(new O([c.g.b(c.K)])).get();d.uniform4fv(c.p.uTransform,o);var h=c.g.transform(sa);d.uniform3f(c.p.uLightPos,h.x,h.y,h.a);P(d,c.p,c.G,c.V,d.TRIANGLES);d.useProgram(c.v.handle);d.uniformMatrix4fv(c.v.uProjection,
!1,c.R);d.uniform4fv(c.v.uTransform,o);d.uniform3f(c.v.uLightPos,h.x,h.y,h.a);P(d,c.v,c.Y,c.ea,d.TRIANGLES);c=a;c.useProgram(f.u.handle);c.cullFace(c.FRONT);c.uniformMatrix4fv(f.u.uProjection,!1,f.R);palette=(new O([f.g.b(f.K)])).get();c.uniform4fv(f.u.uTransform,palette);d=f.g.transform(sa);c.uniform3f(f.u.uLightPos,d.x,d.y,d.a);P(c,f.u,f.G,f.V,c.TRIANGLES);a.flush()}this.e.update();n.setTimeout(S(this.$,this),1E3/60)};
m.prototype.reset=function(){this.w={};this.z={};this.J={};this.ba={};this.X={}};function ba(){this.I=10;this.o=128;this.j=[4,4,4];this.O=this.M=e}function C(a,d,c){return new x(a.I*Math.sin(d)*Math.sin(c),a.I*Math.cos(d),a.I*Math.sin(d)*Math.cos(c))};var n=this;n.requestAnimationFrame=n.requestAnimationFrame||n.webkitRequestAnimationFrame||n.mozRequestAnimationFrame||n.oRequestAnimationFrame||n.msRequestAnimationFrame||function(a){n.setTimeout(a,1E3/60)};function T(a,d){function c(){}c.prototype=d.prototype;a.ia=d.prototype;a.prototype=new c}
function S(a,d,c){var f=d||n;if(arguments>2){var g=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(arguments,g);return a.apply(f,c)}}else return function(){return a.apply(f,arguments)}};window.onload=function(){var a=new U(document);(new m(window,a)).P({c0:new V(a)},"stats")};function V(a){this.e=a;this.G=this.p=e;this.S=!0}T(V,ta);V.prototype.getShaderSource=function(a){return n.document.getElementById(a).text};function W(a,d){return[a+"px."+d,a+"nx."+d,a+"py."+d,a+"ny."+d,a+"pz."+d,a+"nz."+d]}
var L=[W("a","jpg"),W("b","png"),W("c","png"),W("d","jpg"),W("e","png"),W("f","png"),W("g","png"),W("h","png"),W("i","png"),W("j","png"),W("k","jpg"),W("l","png"),W("m","png"),W("n","jpg"),W("o","png"),W("p","jpg"),W("q","png"),W("r","png"),W("s","png"),W("u","png"),W("v","png")];
function F(a,d,c){a.U&&d.deleteTexture(a.U);var c=L[c],f=d.createTexture();d.bindTexture(d.TEXTURE_CUBE_MAP,f);d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MIN_FILTER,d.LINEAR);d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MAG_FILTER,d.LINEAR);for(var g=[d.TEXTURE_CUBE_MAP_POSITIVE_X,d.TEXTURE_CUBE_MAP_NEGATIVE_X,d.TEXTURE_CUBE_MAP_POSITIVE_Y,d.TEXTURE_CUBE_MAP_NEGATIVE_Y,d.TEXTURE_CUBE_MAP_POSITIVE_Z,d.TEXTURE_CUBE_MAP_NEGATIVE_Z],o=0;o<6;++o){var h=document.createElement("img");h.onload=ca(d,g[o],
h);h.src=c[o]}a.U=f}function ca(a,d,c,f){return function(){a.texImage2D(d,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,c);f&&a.generateMipmap(d)}}
function P(a,d,c,f,g){a.bindBuffer(a.ARRAY_BUFFER,c);a.vertexAttribPointer(d.aPosition,3,a.FLOAT,!1,44,0);a.enableVertexAttribArray(d.aPosition);d.aNormal>=0&&(a.vertexAttribPointer(d.aNormal,3,a.FLOAT,!1,44,12),a.enableVertexAttribArray(d.aNormal));d.aColor>=0&&(a.vertexAttribPointer(d.aColor,3,a.FLOAT,!1,44,24),a.enableVertexAttribArray(d.aColor));d.aTexCoord>=0&&(a.vertexAttribPointer(d.aTexCoord,2,a.FLOAT,!1,44,36),a.enableVertexAttribArray(d.aTexCoord));a.drawArrays(g,0,f);a.disableVertexAttribArray(d.aPosition);
d.aNormal>=0&&a.disableVertexAttribArray(d.aNormal);d.aColor>=0&&a.disableVertexAttribArray(d.aColor);d.aTexCoord>=0&&a.disableVertexAttribArray(d.aTexCoord)}var sa=new x(40,0,20),K=Math.PI/64;function X(a,d){this.h=a||0;this.i=d||0}i=X.prototype;i.s=function(){return new X(this.h,-this.i)};i.f=function(a){return new X(this.h+a.h,this.i+a.i)};i.l=function(a){return new X(this.h-a.h,this.i-a.i)};i.m=function(){return new X(-this.h,-this.i)};i.b=function(a){return new X(this.h*a.h,this.h*a.i+this.i*a.h)};i.inverse=function(){return new X(1/this.h,-this.i/this.h/this.h)};i.k=function(a){return this.b(a.inverse())};i.sqrt=function(){return new X(Math.sqrt(this.h),this.i/2/Math.sqrt(this.h))};
i.toString=function(){return this.h+" + "+this.i+"e"};function z(a,d){this.c=a||new Y;this.d=typeof d==="undefined"?new X(1):d}function w(a){return new z(new Y(new X(0,a.x/2),new X(0,a.y/2),new X(0,a.a/2)),new X(1))}function I(a,d){var c=a.t().b(Math.sin(d/2));return new z(new Y(new X(c.x),new X(c.y),new X(c.a)),new X(Math.cos(d/2)))}i=z.prototype;i.h=function(){return new Z(this.c.h(),this.d.h)};i.i=function(){return new Z(this.c.i(),this.d.i)};i.m=function(){return new z(this.c.m(),this.d.m())};i.Q=function(){return this.r().sqrt()};i.r=function(){return this.d.b(this.d).f(this.c.r())};
i.t=function(){return this.k(this.Q())};i.L=function(){return new z(this.c.m(),this.d)};i.s=function(){return new z(this.c.s(),this.d.s())};i.A=function(){return this.L().k(this.r())};i.f=function(a){if(a instanceof X)return new z(this.c,this.d.f(a));else if(a instanceof z)return new z(this.c.f(a.c),this.d.f(a.d))};i.l=function(a){if(a instanceof X)return new z(this.c,this.d.l(a));else if(a instanceof z)return new z(this.c.l(a.c),this.d.l(a.d))};
i.b=function(a){if(a instanceof X)return new z(this.c.b(a),this.d.b(a));else if(a instanceof z)return new z(a.c.b(this.d).f(this.c.b(a.d)).f(this.c.N(a.c)),this.d.b(a.d).l(this.c.C(a.c)));else if(a instanceof O){for(var d=new O,c=0;c<a.n.length;++c)d.set(c,this.b(a.n[c]));return d}};i.k=function(a){if(a instanceof X)return new z(this.c.k(a),this.d.k(a));else if(a instanceof z)return this.b(a.A())};i.transform=function(a){return this.b(new z(new Y(new X(0,a.x),new X(0,a.y),new X(0,a.a)),new X(1))).b(this.s().A()).c.i()};
i.toString=function(){return this.c+" + "+this.d};function Y(a,d,c){this.d=new X;this.c=this;this.x=a||new X;this.y=d||new X;this.a=c||new X}T(Y,z);i=Y.prototype;i.h=function(){return new x(this.x.h,this.y.h,this.a.h)};i.i=function(){return new x(this.x.i,this.y.i,this.a.i)};i.s=function(){return new Y(this.x.s(),this.y.s(),this.a.s())};i.m=function(){return new Y(this.x.m(),this.y.m(),this.a.m())};i.r=function(){return this.C(this)};i.f=function(a){return a instanceof Y?new Y(this.x.f(a.x),this.y.f(a.y),this.a.f(a.a)):z.prototype.f.call(this,a)};
i.l=function(a){return a instanceof Y?new Y(this.x.l(a.x),this.y.l(a.y),this.a.l(a.a)):z.prototype.f.call(this,a)};i.b=function(a){return a instanceof X?new Y(this.x.b(a),this.y.b(a),this.a.b(a)):z.prototype.b.call(this,a)};i.k=function(a){return a instanceof X?new Y(this.x.k(a),this.y.k(a),this.a.k(a)):z.prototype.k.call(this,a)};i.N=function(a){return new Y(this.y.b(a.a).l(this.a.b(a.y)),this.a.b(a.x).l(this.x.b(a.a)),this.x.b(a.y).l(this.y.b(a.x)))};i.C=function(a){return this.x.b(a.x).f(this.y.b(a.y)).f(this.a.b(a.a))};
i.toString=function(){return"("+this.x+")i + ("+this.y+")j + ("+this.a+")k"};function U(a){this.W=a;this.e={};this.H={}}var na=37,pa=38,ma=39,oa=40,ga=87,ia=65,da=74,ha=83,ja=68,la=81,ka=90,ea=78,fa=80,ra=188,qa=190;U.prototype.P=function(){this.W.onkeydown=S(this.ca,this);this.W.onkeyup=S(this.da,this)};U.prototype.ca=function(a){return this.e[a.keyCode]=!0};U.prototype.da=function(a){this.e[a.keyCode]=!1;return!0};U.prototype.update=function(){for(var a in this.e)this.H[a]=this.e[a]};function O(a){this.n=a||[]}i=O.prototype;i.inverse=function(){for(var a=new O,d=0;d<this.n.length;++d)a.set(d,this.n[d].A());return a};i.b=function(a){for(var d=new O,c=0;c<this.n.length;++c)d.set(c,this.n[c].b(a.n[c]));return d};i.set=function(a,d){this.n[a]=d};i.reset=function(){this.n=[]};i.get=function(){for(var a=[],d=0;d<this.n.length;++d){var c=this.n[d];a.push(c.c.x.h,c.c.y.h,c.c.a.h,c.d.h,c.c.x.i,c.c.y.i,c.c.a.i,c.d.i)}return a};function q(a,d){this.name=a.name+":"+d.name;this.F=a;this.D=d}var ua=/(.*)\[.*/;function va(a){var d=a.match(ua);return d?d[1]:a}q.prototype.create=function(a){this.F.create(a);this.D.create(a);this.handle=a.createProgram()};q.prototype.B=function(a){a.detachShader(this.handle,this.F.handle);this.F.B(a);a.detachShader(this.handle,this.D.handle);this.D.B(a);a.deleteProgram(this.handle);this.handle=e};
q.prototype.link=function(a){this.F.compile(a);a.attachShader(this.handle,this.F.handle);this.D.compile(a);a.attachShader(this.handle,this.D.handle);a.linkProgram(this.handle);if(!a.getProgramParameter(this.handle,a.LINK_STATUS)){var d=a.getProgramInfoLog(this.handle);this.B(a);throw Error(d);}for(var d=a.getProgramParameter(this.handle,a.ACTIVE_UNIFORMS),c=0;c<d;++c){var f=va(a.getActiveUniform(this.handle,c).name);this[f]=a.getUniformLocation(this.handle,f)}d=a.getProgramParameter(this.handle,a.ACTIVE_ATTRIBUTES);
for(c=0;c<d;++c)f=va(a.getActiveAttrib(this.handle,c).name),this[f]=a.getAttribLocation(this.handle,f)};function Z(a,d){this.c=a||new x;this.d=typeof d==="undefined"?1:d}i=Z.prototype;i.m=function(){return new Z(this.c.m(),-this.d)};i.Q=function(){return Math.sqrt(this.r())};i.r=function(){return this.d*this.d+this.c.r()};i.t=function(){return this.k(this.Q())};i.L=function(){return new Z(this.c.m(),this.d)};i.A=function(){return this.L().k(this.r())};i.f=function(a){if(typeof a==="number")return new Z(this.c,this.d+a);else if(a instanceof Z)return new Z(this.c.f(a.c),this.d+a.d);return e};
i.l=function(a){if(typeof a==="number")return new Z(this.c,this.d-a);else if(a instanceof Z)return new Z(this.c.l(a.c),this.d-a.d);return e};i.b=function(a){if(typeof a==="number")return new Z(this.c.b(a),this.d*a);else if(a instanceof Z)return new Z(a.c.b(this.d).f(this.c.b(a.d)).f(this.c.N(a.c)),this.d*a.d-this.c.C(a.c));return e};i.k=function(a){if(typeof a==="number")return new Z(this.c.k(a),this.d/a);else if(a instanceof Z)return this.b(a.A());return e};i.transform=function(a){return this.b(a).b(this.A()).c};
i.toString=function(){return this.c+" + "+this.d};function ta(){};function p(a,d,c){this.name=a;this.ha=d;this.ga=c}p.prototype.create=function(a){this.handle=a.createShader(this.ha);a.shaderSource(this.handle,this.ga)};p.prototype.compile=function(a){a.compileShader(this.handle);if(!a.getShaderParameter(this.handle,a.COMPILE_STATUS)){var d=a.getShaderInfoLog(this.handle);this.B(a);throw Error(d);}};p.prototype.B=function(a){a.deleteShader(this.handle);this.handle=e};function x(a,d,c){this.d=0;this.c=this;this.x=a||0;this.y=d||0;this.a=c||0}T(x,Z);var N=new x(1,0,0),J=new x(0,1,0),M=new x(0,0,1);i=x.prototype;i.m=function(){return new x(-this.x,-this.y,-this.a)};i.r=function(){return this.C(this)};i.f=function(a){return a instanceof x?new x(this.x+a.x,this.y+a.y,this.a+a.a):Z.prototype.f.call(this,a)};i.l=function(a){return a instanceof x?new x(this.x-a.x,this.y-a.y,this.a-a.a):Z.prototype.f.call(this,a)};
i.b=function(a){return typeof a==="number"?new x(this.x*a,this.y*a,this.a*a):Z.prototype.b.call(this,a)};i.k=function(a){return typeof a==="number"?new x(this.x/a,this.y/a,this.a/a):Z.prototype.k.call(this,a)};i.N=function(a){return new x(this.y*a.a-this.a*a.y,this.a*a.x-this.x*a.a,this.x*a.y-this.y*a.x)};i.C=function(a){return this.x*a.x+this.y*a.y+this.a*a.a};i.toString=function(){return this.x+"i + "+this.y+"j + "+this.a+"k"};
